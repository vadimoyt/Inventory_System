# Система управления запасами

Веб-приложение, разработанное с использованием FastAPI, для управления продуктами, продажами, запасами, производителями, контрагентами и соглашениями, с функциями аутентификации пользователей и email-уведомлениями о низком уровне запасов.

## Возможности

- **Аутентификация пользователей**: Регистрация, вход и выход с использованием JWT
- **Управление продуктами**: Создание, редактирование, удаление и просмотр продуктов с привязкой к производителям, контрагентам и соглашениям
- **Управление продажами**: Регистрация продаж, обновление запасов и уведомления о низком уровне запасов
- **Управление запасами**: Отслеживание и управление количеством запасов продуктов
- **Управление производителями**: Управление информацией о производителях
- **Управление контрагентами**: Управление данными контрагентов
- **Управление соглашениями**: Работа с соглашениями с контрагентами
- **Отчеты**: Генерация отчетов по продажам и запасам
- **Email-уведомления**: Асинхронные уведомления по email о низких запасах с использованием Celery
- **API**: Получение списка продуктов в формате JSON

## Технологический стек

- **Бэкенд**: FastAPI (Python)
- **База данных**: SQLAlchemy с асинхронной поддержкой (рекомендуется PostgreSQL)
- **Аутентификация**: FastAPI-Login с JWT
- **Шаблоны**: Jinja2
- **Очередь задач**: Celery с Redis как брокером/бэкендом
- **Email**: SMTP с поддержкой TLS
- **Логирование**: Встроенное логирование Python в файл и консоль
- **Среда**: Управление через python-dotenv

## Требования

- Python 3.9+
- PostgreSQL (или другая совместимая с SQLAlchemy база данных)
- Redis (для Celery)
- Учетные данные SMTP-сервера (например, Mail.ru, Gmail)

## Установка

1. **Клонируйте репозиторий**:
   ```bash
   git clone <URL-репозитория>
   cd stock-management-system

2. **Созайте виртуальное окружение**:
    ```bash
    python -m venv venv
    source venv/bin/activate 

3. **Установите зависимости**:
    ```bash
    pip install -r requirements.txt

4. **Настройте переменные окружения в .env**:
    ```bash
    SECRET_KEY=ваш-секретный-ключ
    EMAIL_HOST=smtp.mail.ru
    EMAIL_PORT=587
    EMAIL_USER=ваш-email@example.com
    EMAIL_PASSWORD=ваш-пароль-для-email
    EMAIL_FROM=ваш-email@example.com
    DATABASE_URL=postgresql+asyncpg://пользователь:пароль@localhost:5432/имя_базы

5. **Настройте базу данных**:
	**•	Убедитесь, что PostgreSQL запущен.**
	**•	Создайте базу данных и обновите DATABASE_URL в .env.**
	**•	Выполните миграции**:
     ```bash
    alembic upgrade head

6. **Запустите Redis:
	•	Установите и запустите сервер Redis.
	•	Используется по умолчанию redis://localhost:6379/0.**

7. **Запустите приложение**:
    ```bash
    uvicorn main:app --reload
   
8. **Запустите Celery**:
    ```bash
   celery -A main.celery_app worker --loglevel=info

## Использование

1. Откройте приложение по адресу [http://localhost:8000](http://localhost:8000).
2. Зарегистрируйтесь на странице `/register`.
3. Войдите в систему на странице `/login`.
4. Управляйте сущностями через следующие endpoints:
   - **Продукты**: `/products`
   - **Производители**: `/manufacturer`
   - **Контрагенты**: `/counterparty`
   - **Соглашения**: `/agreement`
   - **Продажи**: `/sales`
   - **Запасы**: `/stocks`
   - **Отчет**: `/report`

## Логирование

- Логи записываются в файл `app.log` и выводятся в консоль.
- В логах содержится информация о процессе работы приложения, предупреждения и ошибки.